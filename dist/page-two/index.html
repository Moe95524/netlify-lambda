<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Subscribe | Smol 11ty lambda</title>
  <link rel="stylesheet" href="/css/style.css">
</head>
<body>
  

<nav>
  <ul role="list">
    <li>
      <a  href="/">Home</a>
    </li>

    
    <li>
      <a 
         
        href="/page-one/">
          Test
      </a>
    </li>
    <li>
      <a 
        aria-current="page" 
        href="/page-two/">
          Subscribe
      </a>
    </li>
  </ul>
</nav>

  
<header>
  <h1>Subscribe</h1>
</header>
<main>
  <article>
    <p>
Want to be informed when I post new articles? simply enter your
email address below. maybe you'll not get any email i'm doing this only for test, you can 
unsubscribe any time. 
</p>
<form data-members-form="subscribe" class="subscribe-form">
<div id="app" class="form-group">
	<label for="subscribe-email" class="screen-reader-text">Your email address</label>
	<input v-model="email" type="email" class="subscribe-email" placeholder="Your email address"> 
	<button @click="doSubscribe" :disabled="working" class="button" type="submit">Subscribe</button>
	<p style="font-weight: bold">
<pre><code>{{ status }}

&lt;/p&gt;
&lt;/div&gt;
</code></pre>
</form>
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<script>
const SUBSCRIBE_API = '/.netlify/functions/mailchimp-check?email=';

const app = new Vue({
	el:'#app',
	data: {
		email:'',
    	working:false,
		status:''
	},
	methods: {
		async doSubscribe() {
			if(this.email === '') return;
			this.working = true;
			console.log('do add for'+this.email);
			this.status = 'Attemping to subscribe you...';
			
			fetch(SUBSCRIBE_API + this.email)
			.then(res => {
				return res.json()
			})
			.then(res => {
				console.log('status',res.status);
				if(res.status === 'subscribed') {
					this.status = 'You have been subscribed!';
				} else if(res.status === 400) {
					this.status = `There was an error: ${res.detail}`;
				}
				this.working = false;
			})
			.catch(e => {
				console.log('error result', e);
			});
		}
	}
})
</script>
  </article>
</main>

  <footer>
    <div>
      <p>&copy; 2021 Smol 11ty lambda â€¢ Mohammed Alhashim</p>
    </div>
  </footer>

</body>
</html>